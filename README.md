
# Terraform Qualys Cloud Connector Provider

This provider allows managing Qualys Azure and AWS Cloud View Connectors as well as Azure Asset View Connectors.

https://www.qualys.com/docs/qualys-cloudview-api-user-guide.pdf

https://qualysguard.qualys.eu/cloudview-api/swagger-ui.html#!/

https://www.qualys.com/docs/qualys-asset-management-tagging-api-v2-user-guide.pdf

## Settings

### Environment variables
To run the tests or prevent passing in senstive information in Terraform config, please use the following environment variables:

- QUALYS_CLOUDVIEW_API
- QUALYS_ASSETVIEW_API
- QUALYS_API_USERNAME
- QUALYS_API_PASSWORD

### Firewall
The API requests for AssetView API must come from an IP address whitelisted in Vulnerability Management -> Users -> Set Up Security

## Compiling

For Windows
```
go build -o terraform-provider-qualys_v0.1.0.exe
```

For Linux
```
GOOS=linux GOARCH=amd64 go build -o terraform-provider-qualys_v0.1.0
# make it executable
git update-index --chmod=+x .terraform/plugins/linux_amd64/terraform-provider-qualys_v0.1.0
git commit -m "updated permissions"
git push
```

Place the compiled files into:
.terrafrom/plugins/linux_amd64/terraform-provider-qualys_v0.1.0
.terrafrom/plugins/windows_amd64/terraform-provider-qualys_v0.1.0.exe

## Testing

The code contains basic acceptance tests that you can run:
```
TF_ACC=true go test -v provider/*
```

## Debugging
Use `log.Print()` and set environment variables:
```
export TF_LOG=1
export TF_LOG_PATH="C:\Temp\mylog.txt"
```


## Qualys Azure CloudView Connector example

Please note modifying `subscription_id` forces redeployment as the API doesn't allow to update this property.

```
provider "qualys" {
  cloudview_api      = "https://qualysguard.qualys.eu/cloudview-api/rest/v1"
  assetview_api      = "https://qualysapi.qualys.eu/qps/rest/2.0"
  username = "<the API username>"
  password = "<the API password>"
}

resource "qualys_cloudview_azure_connector" "example" {
  name               = "AzCvConnector"
  description        = "Description"
  directory_id       = "<Azure AppID Directory ID>"
  subscription_id    = "<Azure AppID Subscription ID>"
  application_id     = "<Azure AppID>"
  authentication_key = "<Azure AppID Authentication Key>"
  is_gov_cloud       = false
}
data "qualys_cloudview_azure_connector" "ds_azcv_by_id_example" {
     connector_id = "<Qualys Cloud Connector ID>"
}
data "qualys_cloudview_azure_connector" "ds_azcv_by_subid_example" {
     subscription_id = "<Subscription ID>"
}
```

## Qualys Azure AssetView Connector example

Please note modifying `directory_id`, `subscription_id`, `application_id` or `authentication_key` forces redeployment as the API doesn't allow to update these properties.

```
provider "qualys" {
  cloudview_api      = "https://qualysguard.qualys.eu/cloudview-api/rest/v1"
  assetview_api      = "https://qualysapi.qualys.eu/qps/rest/2.0"
  username = "<the API username>"
  password = "<the API password>"
}

resource "qualys_assetview_azure_connector" "example" {
  name               = "AzAvConnector"
  description        = "Description"
  directory_id       = "<Azure AppID Directory ID>"
  subscription_id    = "<Azure AppID Subscription ID>"
  application_id     = "<Azure AppID>"
  authentication_key = "<Azure AppID Authentication Key>"
  is_gov_cloud       = false
  default_tags = {"16568284" = "Cloud Connector"}  
}
data "qualys_cloudview_azure_connector" "ds_azav_by_id_example" {
     connector_id = "<Qualys Cloud Connector ID>"
}
data "qualys_cloudview_azure_connector" "ds_azav_by_subid_example" {
     subscription_id = "<Subscription ID>"
}
```

## Attributes Reference
The following attributes are exported.
### Qualys Azure CloudView Connector:
- id - Autogenerated Qualys Connector ID (UUID)
- name
- description
- directory_id
- subscription_id
- application_id
- is_gov_cloud
- last_synced_on
- total_assets
- state

### Qualys Azure AssetView Connector:
- id - Autogenerated Qualys Connector ID (int)
- name
- description
- directory_id
- subscription_id
- application_id
- is_gov_cloud
- last_synced_on
- total_assets
- state
- default_tags